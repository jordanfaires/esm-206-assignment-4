---
title: "ESM 206 Assignment 4: Spiny Lobster Abundance"
author: "Jordan Faires"
date: "11/14/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*Introduction*

*Methods*

*Results*


```{r}
# Load packages

library(tidyverse)
library(here)
library(janitor)
library(RColorBrewer)

# Read in data, clean names

lobster_abundance <-read.csv("lobster_abundance_sbc_lter.csv",
  na = "-99999") %>% 
  clean_names()

# Make data tidy

lobster_tidy <- lobster_abundance %>% 
  tidyr::uncount(count)

```

# Results A:

```{r}
# Group & summarize lobster data for each location by year

lobster_ysite <- lobster_tidy %>% 
  count(year, site) %>% 
  group_by(site)

ggplot(lobster_ysite, aes(x=year, y=n, group=site, color=site)) +
  geom_line() +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        panel.background = element_rect(fill = "gray99", size = .1)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "Annual Count",
       title = "Annual Count of California Spiny Lobsters") +
    scale_color_discrete(breaks=c("AQUE", 
                                  "CARP", 
                                  "IVEE", 
                                  "MOHK", 
                                  "NAPL"),
                       labels=c("Arroyo Quemado", 
                                "Carpenteria", 
                                "Isla Vista (Marine Protected Area)", 
                                "Mohawk", 
                                "Naples (Marine Protected Area)")) +
  theme(legend.position = c(0.25, 0.7)) +
  theme(legend.title = element_blank())

```
***Figure 1.*** *Annual count of California Spiny Lobsters at five sampling locations in Santa Barbara County, California, 2012 to 2018. Sampling locations located within a Marine Protected Area are indicated in the legend.*

The annual number of lobsters observed at all sampling locations appears to be increasing overall between 2012 to 2018. However, some locations saw much greater increases in the numbers of lobsters observed over time. The locations within marine protected areas (Isla Vista and Naples) where the only two locations to see an increase in the annual count of lobsters between 2017 and 2018. 

# Results B:

```{r}

lobster_size_diff <- lobster_tidy %>%
  filter(year == 2012 | year == 2018)
  
ggplot(lobster_size_diff, aes(x = site, y = size_mm)) +
         geom_violin(aes(fill = as.factor(year)), 
                     position = position_dodge(0.9)) +
  geom_boxplot(aes(fill = as.factor(year)), 
               alpha = .5, 
               position = position_dodge(0.9), 
               width = .25) +
  theme_minimal() +
  scale_fill_brewer(palette="Pastel2") +
  labs(x = "",
       y = "Size (mm)",
       title = "Size Distribution of Observed Lobsters, 2012 and 2018") +
  scale_x_discrete(labels = c("Arroyo \nQuemado",
                              "Carpenteria",
                              "Isla Vista \n(MPA)",
                              "Mohawk",
                              "Naples \n(MPA)")) +
    theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        panel.background = element_rect(fill = "gray99", size = .1)) +
  labs(fill = "Year")
  

```
***Figure 2. Community size distribution (mm) of California Spiny Lobsters at five sampling locations in 2012 (green) and 2018 (orange).*** *Median is indicated by horizontal line, whiskers indicate a 95% confidence interval and points are individual outlying observations. Isla Vista and Naples sites are within Marine Protected Areas (MPAs).*

The community size of sampled lobsters is relatively constant across site that are not Marine Protected Areas. The community size at Arroyo Quemado and Carpenteria appear to have slightly increased between 2012 and 2018, while the community size at Mohawk appears to have slightly decreased. However, the two MPA sites (Isla Vista and Naples) appear to have significant growth in community size between 2012 and 2018. 

# Results C 

```{r}

# Assign MPA / non-MPA status 
lobster_mpa <- lobster_tidy %>%
  filter(site %in% c("IVEE", "NAPL"))

lobster_non_mpa <- lobster_tidy %>% 
  filter(site %in% c("MOHK", "AQUE", "CARP"))

```

```{r}

# Question 1 - For 2012 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

# Filter for 2012 in both data sets

lobster_mpa_2012 <- lobster_mpa %>% 
  filter(year == 2012)

lobster_non_mpa_2012 <- lobster_non_mpa %>% 
  filter(year == 2012)

# Two - sided t-test

t_test_2012_size <- t.test(lobster_mpa_2012$size_mm, lobster_non_mpa_2012$size_mm)
  
t_test_2012_size

```
In 2012, mean lobster size (mm) for MPA sites (`r round(t_test_2012_size$estimate[1],2)`) and non-MPA sites (`r round(t_test_2012_size$estimate[2],2)`) differed significantly (t(`r round(t_test_2012_size$parameter,2)`) = `r round(t_test_2012_size$statistic,2)`, *p* = `r round(t_test_2012_size$p.value,2)`). 

```{r}
# Question 2 - For 2018 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

# Filter for 2018 in both data sets

lobster_mpa_2018 <- lobster_mpa %>% 
  filter(year == 2018)

lobster_non_mpa_2018 <- lobster_non_mpa %>% 
  filter(year == 2018)

t_test_2018_size <- t.test(lobster_mpa_2018$size_mm, lobster_non_mpa_2018$size_mm)

t_test_2018_size

```

In 2018, mean lobster size (mm) for MPA sites (`r round(t_test_2018_size$estimate[1],2)`) and non-MPA sites (`r round(t_test_2012_size$estimate[2],2)`) also differed significantly (t(`r round(t_test_2018_size$parameter,2)`) = `r round(t_test_2018_size$statistic,2)`, *p* = `r round(t_test_2018_size$p.value,2)`). FIX THIS P VALUE.
