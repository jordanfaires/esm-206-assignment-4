---
title: "ESM 206 Assignment 4: Spiny Lobster Abundance"
author: "Jordan Faires"
date: "11/14/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

# Introduction 

# Methods

# Results


```{r}
# Load packages

library(tidyverse)
library(here)
library(janitor)
library(RColorBrewer)
library(effsize)
library(DT)

# Read in data, clean names

lobster_abundance <-read.csv("lobster_abundance_sbc_lter.csv",
  na = "-99999") %>% 
  clean_names()

# Make data tidy

lobster_tidy <- lobster_abundance %>% 
  tidyr::uncount(count)

```

## Results A:

The annual number of lobsters observed at all sampling locations appears to have increased between 2012 to 2018. However, some locations saw much greater increases in the number of lobsters observed over time. The locations within marine protected areas (Isla Vista and Naples) were the only two locations to see an increase in the annual count of lobsters between 2017 and 2018. 

```{r}
# Group & summarize lobster data for each location by year

lobster_ysite <- lobster_tidy %>% 
  count(year, site) %>% 
  group_by(site)

ggplot(lobster_ysite, aes(x=year, y=n, group=site, color=site)) +
  geom_line() +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        panel.background = element_rect(fill = "gray99", size = .1)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "Annual Count",
       title = "Annual Count of California Spiny Lobsters, 2012 -2018") +
    scale_color_discrete(breaks=c("AQUE", 
                                  "CARP", 
                                  "IVEE", 
                                  "MOHK", 
                                  "NAPL"),
                       labels=c("Arroyo Quemado", 
                                "Carpenteria", 
                                "Isla Vista (Marine Protected Area)", 
                                "Mohawk", 
                                "Naples (Marine Protected Area)")) +
  theme(legend.position = c(0.25, 0.7)) +
  theme(legend.title = element_blank())

```
***Figure 1.*** *Annual count of California Spiny Lobsters at five sampling locations in Santa Barbara County, California, 2012 to 2018. Locations located within a Marine Protected Area are indicated in the legend.*

## Results B:

The community size of sampled lobsters is relatively constant across site that are not Marine Protected Areas. The community size at Arroyo Quemado and Carpenteria appear to have slightly increased between 2012 and 2018, while the community size at Mohawk appears to have slightly decreased. However, the two MPA sites (Isla Vista and Naples) appear to have significant growth in community size between 2012 and 2018. 

```{r}

lobster_size_diff <- lobster_tidy %>%
  filter(year == 2012 | year == 2018)
  
ggplot(lobster_size_diff, aes(x = site, y = size_mm)) +
         geom_violin(aes(fill = as.factor(year)), 
                     position = position_dodge(0.9)) +
  geom_boxplot(aes(fill = as.factor(year)), 
               alpha = .5, 
               position = position_dodge(0.9), 
               width = .25) +
  theme_minimal() +
  scale_fill_brewer(palette="Pastel2") +
  labs(x = "",
       y = "Size (mm)",
       title = "Size Distribution of California Spiny Lobsters, 2012 and 2018") +
  scale_x_discrete(labels = c("Arroyo \nQuemado",
                              "Carpenteria",
                              "Isla Vista \n(MPA)",
                              "Mohawk",
                              "Naples \n(MPA)")) +
    theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        panel.background = element_rect(fill = "gray99", size = .1)) +
  labs(fill = "Year")
  

```
***Figure 2.*** *Community size distribution (mm) of California Spiny Lobsters at five sampling locations in 2012 (green) and 2018 (orange). Median is indicated by horizontal line, whiskers indicate a 95% confidence interval and points are individual outlying observations. Isla Vista and Naples sites are within Marine Protected Areas (MPAs).*

# Results C 

```{r}

# Assign MPA / non-MPA status 
lobster_mpa <- lobster_tidy %>%
  filter(site %in% c("IVEE", "NAPL"))

lobster_non_mpa <- lobster_tidy %>% 
  filter(site %in% c("MOHK", "AQUE", "CARP"))

```

```{r}

# Question 1 - For 2012 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

# Filter for 2012 in both data sets

lobster_mpa_2012 <- lobster_mpa %>% 
  filter(year == 2012)

lobster_non_mpa_2012 <- lobster_non_mpa %>% 
  filter(year == 2012)

# Two - sided t-test

t_test_2012_size <- t.test(lobster_mpa_2012$size_mm, lobster_non_mpa_2012$size_mm)
  
# One sided - is MPA 2012 smaler than non-MPA 2012? 

t_test_2012_directional <- t.test(lobster_mpa_2012$size_mm,
                                  lobster_non_mpa_2012$size_mm,
                                  alternative = "less")

# Yes - MPA 2012 smaller than non-MPA 2012. 

# Calculate effect size with Cohen's d

mpa_nonmpa_2012_d <- cohen.d(lobster_non_mpa_2012$size_mm,lobster_mpa_2012$size_mm)

# Medium effect (-.61)

```

In 2012, the mean lobster size (mm) observed in MPA sites (`r round(t_test_2012_directional$estimate[1],2)`) is significantly less than mean lobster size for non-MPA (`r round(t_test_2012_directional$estimate[2],2)`) sites by a one-sided t-test (t(`r round(t_test_2012_directional$parameter,2)`) = `r round(t_test_2012_directional$statistic,2)`, *p* = `r round (t_test_2012_directional$p.value,2)`). The effect size by Cohen's *d* is medium (`r round(mpa_nonmpa_2012_d$estimate,2)`).

```{r}
# Question 2 - For 2018 observations, is there a significant difference in lobster size between MPA and non-MPA sites? 

# Filter for 2018 in both data sets

lobster_mpa_2018 <- lobster_mpa %>% 
  filter(year == 2018)

lobster_non_mpa_2018 <- lobster_non_mpa %>% 
  filter(year == 2018)

t_test_2018_size <- t.test(lobster_mpa_2018$size_mm, lobster_non_mpa_2018$size_mm)

# One sided - is MPA 2018 greater than non-MPA 2018? 

t_test_2018_size_directional <- t.test(lobster_mpa_2018$size_mm,
                                       lobster_non_mpa_2018$size_mm,
                                       alternative = "greater")

# Yes - MPA 2018 greater than non-MPA 2018.

# Calculate effect size with Cohen's d

mpa_nonmpa_2018_d <- cohen.d(lobster_mpa_2018$size_mm,lobster_non_mpa_2018$size_mm)


# Effect size small (.35)

```

In 2018, the mean lobster size (mm) observed in MPA sites (`r round(t_test_2018_size_directional$estimate[1],2)`) is significantly greater than mean lobster size for non-MPA sites (`r round(t_test_2018_size_directional$estimate[2],2)`) by a one-sided t-test (t(`r round(t_test_2018_size_directional$parameter,2)`) = `r round(t_test_2018_size_directional$statistic,2)`, *p* = < 0.001). However, the effect size by Cohen's *d* is small (`r round(mpa_nonmpa_2018_d$estimate,2)`).

```{r}

# Question 3 - For MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?

t_test_MPA_over_time <- t.test(lobster_mpa_2012$size_mm, lobster_mpa_2018$size_mm)

# One sided - is MPA 2012 less than MPA 2018? (i.e. is MPA 2018 greater than MPA 2012?)

t_test_mpa_time_directional <- t.test(lobster_mpa_2018$size_mm, 
                                      lobster_mpa_2012$size_mm, 
                                      alternative = "greater")

# Yes - MPA 2018 greater than MPA 2012. 

# Calculate effect size with Cohen's d

mpa_over_time_d <- cohen.d(lobster_mpa_2018$size_mm,lobster_mpa_2012$size_mm)

# Effect large (.87)
                                
```

Mean lobster size (mm) observed at MPA sites in 2012 (`r round(t_test_MPA_over_time$estimate[1],2)`) and 2018 (`r round(t_test_MPA_over_time$estimate[2],2)`) also differed significantly, with lobster size in MPA sites significantly greater in 2018 than in 2012 by a one-sided t-test (t(`r round(t_test_mpa_time_directional$parameter,2)`) = `r round(t_test_MPA_over_time$statistic,2)`, *p* = < 0.001). The effect size by Cohen's *d* is large (`r round(mpa_over_time_d$estimate,2)`).

```{r}

# Question 4 For non-MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?

t_test_non_mpa_over_time <- t.test(lobster_non_mpa_2012$size_mm, lobster_non_mpa_2018$size_mm)

# No need for one sided here - not significantly different. 

```
However, mean lobster size (mm) observed at non-MPA sites in 2012 (`r round(t_test_non_mpa_over_time$estimate[1],2)`) and 2018 (`r round(t_test_non_mpa_over_time$estimate[2],2)`) is not significantly different (t(`r round(t_test_non_mpa_over_time$parameter,2)`) = `r round(t_test_non_mpa_over_time$statistic,2)`, *p* = `r round (t_test_non_mpa_over_time$p.value,2)`)


```{r}

name = c("MPA Sites, 2012", "MPA Sites, 2018", "Non-MPA Sites, 2012", "Non-MPA Sites, 2018")
mean = c(round(mean(lobster_mpa_2012$size_mm), 
               digits = 3),
         round(mean(lobster_mpa_2018$size_mm), 
               digits = 3),
         round(mean(lobster_mpa_2012$size_mm), 
               digits = 3),
         round(mean(lobster_mpa_2018$size_mm), 
               digits = 3))
sd = c(round(sd(lobster_mpa_2012$size_mm), 
             digits = 3),
       round(sd(lobster_mpa_2018$size_mm), 
             digits = 3),
       round(sd(lobster_non_mpa_2012$size_mm), 
             digits = 3),
       round(sd(lobster_non_mpa_2018$size_mm)))
count = c(nrow(lobster_mpa_2012),
           nrow(lobster_mpa_2018),
           nrow(lobster_non_mpa_2012),
           nrow(lobster_non_mpa_2018))

table_df_lobster <- data.frame(name, count, mean, sd) %>%
  datatable(colnames = c("Site Type and Year", "Sample Size", "Mean Lobster Length (mm)", "Standard Deviation"), options = list(dom = 't'))

table_df_lobster

```



# Summary

- The mean lobster length observed at Marine Protected Area (MPA) sites (Isla Vista and Naples) was smaller than the mean lobster length at non-MPA sites (Arroyo Quemado, Carpenteria and Mohawk) in 2012. However, the mean lobster length at MPA sites was greater than the mean length at non-MPA sites in 2018.  
- At MPA sites, the number of lobsters observed increased between 2012 to 2018. The mean length of the lobsters observed at MPA sites also increased significantly over this time period.
- The number of lobsters observed at non-MPA sites also increased between 2012 and 2018. However, there was no difference in mean lobster length between 2012 and 2018 for non-MPA sites. 


# References




